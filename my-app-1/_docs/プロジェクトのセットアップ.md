# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã‚³ãƒãƒ³ãƒ‰

```bash
npx create-next-app@latest my-app-16
```

å®Ÿè¡Œçµæœãƒ­ã‚°

```bash
Need to install the following packages:
create-next-app@16.0.1
Ok to proceed? (y) y
âœ” Would you like to use the recommended Next.js defaults? â€º No, customize settings
âœ” Would you like to use TypeScript? â€¦ No / *Yes
âœ” Which linter would you like to use? â€º ESLint
âœ” Would you like to use React Compiler? â€¦ *No / Yes
âœ” Would you like to use Tailwind CSS? â€¦ No / *Yes
âœ” Would you like your code inside a `src/` directory? â€¦ No / *Yes
âœ” Would you like to use App Router? (recommended) â€¦ No / *Yes
âœ” Would you like to use Turbopack? (recommended) â€¦ No / *Yes
âœ” Would you like to customize the import alias (`@/*` by default)? â€¦ *No / Yes
Creating a new Next.js app in /workspaces/portfolio-nextjs/my-app-16.

Using npm.

Initializing project with template: app-tw 


Installing dependencies:
- react
- react-dom
- next

Installing devDependencies:
- typescript
- @types/node
- @types/react
- @types/react-dom
- @tailwindcss/postcss
- tailwindcss
- eslint
- eslint-config-next


added 366 packages, and audited 367 packages in 1m

145 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities

Generating route types...
âœ“ Route types generated successfully

Success! Created my-app-16 at /workspaces/portfolio-nextjs/my-app-16
```

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å½¢å¼

package.json
```js
{
  "name": "my-app-16",
  "version": "0.1.0",
  "private": true,
  "type": "module",   // â˜…ã“ã‚Œã‚’æŒ‡å®šã™ã‚‹
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    ...
}
```
* `"type": "module"` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’ ESM(ESModules) ã§çµ±ä¸€ã™ã‚‹ã€‚

tsconfig.json
```js
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",                 // â˜…ã“ã‚Œã‚’æŒ‡å®šã™ã‚‹
    "moduleResolution": "bundler",      // â˜…ã“ã‚Œã‚’æŒ‡å®šã™ã‚‹
    "resolveJsonModule": true,
    "isolatedModules": true,
    ...
}
```
* `"module": "esnext"` `"moduleResolution": "bundler"` - Next.js ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š

# APIãƒ¢ãƒƒã‚¯(Express)

Express ã‚’ä½¿ã£ãŸ API ãƒ¢ãƒƒã‚¯ã€‚TypeScript / ESM æ§‹æ–‡ã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### tsx ã‚’ä½¿ã£ã¦ãƒ¢ãƒƒã‚¯ã‚’èµ·å‹•ã™ã‚‹å ´åˆ

tsx ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install -D tsx
```

 èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```js
// package.json
{
  "name": "my-app-16",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "mock1": "tsx watch __mocks__/customers.ts"  // â˜…èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
  },
  ...
}
```
* `watch` - ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç›£è¦–ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«è‡ªå‹•ã§å†å®Ÿè¡Œã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã€‚

### ts-node/esm ã‚’ä½¿ã£ã¦ãƒ¢ãƒƒã‚¯ã‚’èµ·å‹•ã™ã‚‹å ´åˆ

ts-node ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install -D ts-node
```
 èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```js
// package.json
{
  "name": "my-app-16",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "mock1": "tsx watch __mocks__/customers.ts",
    "mock2": "node --no-warnings --loader ts-node/esm __mocks__/users.mts",  // â˜…èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
  },
  ...
}
```

### ãƒ¢ãƒƒã‚¯ã®èµ·å‹•
```bash
npm run mock1
```

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“ã¨APIãƒ¢ãƒƒã‚¯ã‚’ä¸€ç·’ã«èµ·å‹•ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

npm-run-all ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install -D npm-run-all
```

èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```js
// package.json
{
  "name": "nextjs",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "mock1": "tsx watch __mocks__/customers.ts",
    "dev:mock": "npm-run-all --parallel dev mock1",  // â˜…èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
  ...
}
```

èµ·å‹•ã‚³ãƒãƒ³ãƒ‰
```bash
npm run dev:mock
```

# Next:Jest

Next.js ç”¨ã® Jest æ§‹æˆã€‚Jest ã‚³ãƒ¼ãƒ‰ã‚’ TypeScript / ESM æ§‹æ–‡ã§å®Ÿè£…ã—ã€ ESM ãƒ¢ãƒ¼ãƒ‰ã§ Jest ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install -D jest @types/jest
```
```bash
npm install -D cross-env
```
* Jest ã¯ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§CJS(CommonJS) ã§å‹•ä½œã™ã‚‹ãŸã‚ã€ESM ã§å‹•ä½œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã« cross-env ã‚’ä½¿ç”¨ã™ã‚‹ã€‚


è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹

```bash
npm init jest@latest
```

```bash
The following questions will help Jest to create a suitable configuration for your project

âœ” Would you like to use Jest when running "test" script in "package.json"? â€¦ no
âœ” Would you like to use Typescript for the configuration file? â€¦ yes
âœ” Choose the test environment that will be used for testing â€º node
âœ” Do you want Jest to add coverage reports? â€¦ yes
âœ” Which provider should be used to instrument code for coverage? â€º v8
âœ” Automatically clear mock calls, instances, contexts and results before every test? â€¦ yes

ğŸ“  Configuration file created at /workspaces/portfolio-nextjs-2/my-app-1/jest.config.ts
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `next/jest` ã‚’ä½¿ç”¨ã™ã‚‹æ§‹æˆã¨ã—ã¦å¤‰æ›´ã™ã‚‹ã€‚

```ts
// jest.config.ts
import nextJest from 'next/jest.js';

const createJestConfig = nextJest({
	dir: './',
});

const config = {
	clearMocks: true,
	collectCoverage: true,
	coverageDirectory: "coverage",
	coverageProvider: "v8",
	moduleNameMapper: {
		'^@/(.*)$': '<rootDir>/$1',
	},
	testEnvironment: "jest-environment-node",
	testMatch: ['**/__tests__/next-jest/**/*.?([mc])[jt]s?(x)'],
	extensionsToTreatAsEsm: ['.ts', '.tsx'],
};

export default createJestConfig(config);
```
* `extensionsToTreatAsEsm: ['.ts', '.tsx']` - Jest ã‚’ ESM ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã€.ts ã‚’ ESM ã¨ã—ã¦æ‰±ã†è¨­å®šã€‚

ãƒ‘ã‚¹è§£æ±ºã®è¨­å®š
```js
// tsconfig.json
{
  "compilerOptions": {
    ...
    "paths": {
      "@/*": ["./src/*"],
      "@/__tests__/*": ["./__tests__/*"]	// â˜…ã“ã‚Œã‚’è¿½åŠ 
    }
  },
  ...
}
```
* tsconfig.json ã¯ã€VSCode ã®è£œå®Œ / å‹ãƒã‚§ãƒƒã‚¯(é™çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ)ã§ä½¿ç”¨ã•ã‚Œã‚‹

```ts
// jest.config.ts
...
const config = {
	...
	moduleNameMapper: {
		'^@/(.*)$': '<rootDir>/src/$1',	// â˜…ã“ã‚Œã‚’è¨˜è¿°
	},
	...
};
...
```
* jest.config.ts ã¯ jest å®Ÿè¡Œæ™‚ã®ãƒ‘ã‚¹è§£æ±ºã§ä½¿ç”¨ã•ã‚Œã‚‹ï¼ˆå‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚„ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ¢ãƒƒã‚¯ãªã©ï¼‰

Jest å®Ÿè¡Œ

```bash
npm exec -- cross-env NODE_OPTIONS=--experimental-vm-modules jest [ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å] -t [ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰å]

# ã‚³ãƒãƒ³ãƒ‰ä¾‹
# npm exec -- cross-env NODE_OPTIONS=--experimental-vm-modules jest __tests__/next-jest/path-alias-resolution.test.ts -t 'test1-2'
```
* `cross-env NODE_OPTIONS=--experimental-vm-modules` - Jest ã‚’ ESM ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã™ã‚‹ã€‚

# Node:test

Jest ã‚’ä½¿ç”¨ã—ãªã„ã§ Node ã®çµ„ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã®æ§‹æˆã€‚ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ TypeScript / ESM æ§‹æ–‡ã§å®Ÿè£…ã—ã€ ESM ãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã€‚

tsx ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install -D tsx
```

ãƒ‘ã‚¹è§£æ±ºã®è¨­å®š

```js
// tsconfig.json
{
  "compilerOptions": {
    ...
    "paths": {
      "@/*": ["./src/*"],
      "@/__tests__/*": ["./__tests__/*"]	// â˜…ã“ã‚Œã‚’è¿½åŠ 
    }
  },
  ...
}
```
* é™çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚‚å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚‚ã€tsconfig.json ã«åŸºã¥ã„ã¦ãƒ‘ã‚¹è§£æ±ºã•ã‚Œã‚‹ã€‚

node:test ã‚’å®Ÿè¡Œ
```bash
npm exec -- node --test --import tsx [ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å]

# ã‚³ãƒãƒ³ãƒ‰ä¾‹
# npm exec -- node --test --import tsx __tests__/node-test/path-alias-resolution.test.ts
```



# Prettier

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install --save-dev prettier prettier-plugin-tailwindcss
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
``` bash
echo > .prettierrc.cjs
```
* .prettierrcã ã¨JSONå½¢å¼ã®ãŸã‚ã‚³ãƒ¡ãƒ³ãƒˆãŒè¨˜è¿°ã§ããªã„ã€‚ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¿°ã§ãã‚‹ã‚ˆã†ã«.jsãƒ•ã‚¡ã‚¤ãƒ«ã§ä½œæˆã—ã€ã‹ã¤CommonJSå½¢å¼ã¨ã™ã‚‹ã€‚

# ESLint

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install --save-dev eslint-config-prettier
```

* `eslint-config-prettier` - Prettier ã¨ç«¶åˆã™ã‚‹ ESLint ã®æ•´å½¢ç³»ãƒ«ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã€‚  ãªãŠã€ESLint ã« Prettierã‚’çµ„ã¿è¾¼ã‚“ã§å®Ÿè¡Œã™ã‚‹ï¼ˆPrettier ã‚’ ESLint ãƒ«ãƒ¼ãƒ«ã¨ã—ã¦èµ°ã‚‰ã›ã‚‹ï¼‰ã‚„ã‚Šæ–¹ã¯ç¾åœ¨ã¯éæ¨å¥¨ã€‚Prettier ã¯ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã¨ã—ã¦å˜ä½“ã§å‹•ã‹ã—ã€ESLint ã¯å“è³ªãƒã‚§ãƒƒã‚¯ã€eslint-config-prettier ã§ç«¶åˆã™ã‚‹ ESLint ã®æ•´å½¢ç³»ãƒ«ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã€‚

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

``` ts
// eslint.config.mjs
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";
import { defineConfig, globalIgnores } from "eslint/config";
import eslintConfigPrettier from "eslint-config-prettier"; // â˜…ã“ã‚Œã‚’è¿½åŠ 

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  globalIgnores([".next/**", "out/**", "build/**", "next-env.d.ts"]),
  eslintConfigPrettier, // â˜…ã“ã‚Œã‚’è¿½åŠ ã€‚é…åˆ—ã®æœ€å¾Œã«æ›¸ãã®ãŒãƒã‚¤ãƒ³ãƒˆ
]);

export default eslintConfig;
```


